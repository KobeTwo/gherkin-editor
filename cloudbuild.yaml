steps:
  - name: gcr.io/cloud-builders/docker
    args: ['run', '-d', '-p', '9200:9200', '-p', '9300:9300', '-e', 'discovery.type=single-node', 'docker.elastic.co/elasticsearch/elasticsearch:6.4.2']
  - name: gcr.io/cloud-builders/docker
    args: ['run', 'busybox', 'sleep', '20s']
  - name: gcr.io/cloud-builders/docker
    args: ['ps']
  - name: gcr.io/cloud-builders/mvn
    args: ['package']
  - name: gcr.io/cloud-builders/gsutil
    args: ['cp', 'target/gherkineditor-release.jar', 'gs://gherkin-editor-release/gherkineditor-$TAG_NAME.jar']
  - name: 'gcr.io/cloud-builders/docker'
    args: ['build', '-t', 'gcr.io/$PROJECT_ID/gherkineditor:$TAG_NAME', '.']
images:
  - 'gcr.io/$PROJECT_ID/gherkineditor:$TAG_NAME'